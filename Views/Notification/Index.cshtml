@model List<MTU.Models.Entities.Notification>
@{
    ViewData["Title"] = "Thông báo";
    Layout = "_Layout";
}

<div class="notification-container">
    <div class="notification-header-card">
        <i class="fas fa-bell notification-icon"></i>
        <h4 class="notification-title">Thông báo</h4>
    </div>

    @if (Model.Any())
    {
        <div class="notification-list">
            @foreach (var notification in Model)
            {
                var senderName = notification.Sender != null 
                    ? (!string.IsNullOrWhiteSpace($"{notification.Sender.FirstName} {notification.Sender.LastName}") 
                        ? $"{notification.Sender.FirstName} {notification.Sender.LastName}" 
                        : notification.Sender.Username)
                    : "Hệ thống";
                var avatar = notification.Sender?.Avatar ?? "/assets/user.png";
                var link = notification.RelatedId.HasValue ? $"/Post/Details/{notification.RelatedId}" : "#";
                
                var typeIcon = "fa-bell";
                var typeClass = "";
                if (notification.Type == "like") { typeIcon = "fa-heart"; typeClass = "type-like"; }
                else if (notification.Type == "comment") { typeIcon = "fa-comment"; typeClass = "type-comment"; }
                else if (notification.Type == "friend_request") { typeIcon = "fa-user-plus"; typeClass = "type-friend"; }

                <a href="@link" class="notification-card @(notification.IsRead ? "" : "unread")">
                    <div style="position: relative;">
                        <img src="@avatar" class="notification-sender-avatar">
                        <span class="notification-type-badge @typeClass">
                            <i class="fas @typeIcon"></i>
                        </span>
                    </div>
                    
                    <div class="notification-content-wrapper">
                        <p class="notification-message">
                            <strong>@senderName</strong> @notification.Content
                        </p>
                        <span class="notification-timestamp">
                            @{
                                var timeSpan = DateTime.Now - notification.CreatedAt;
                                if (timeSpan.TotalMinutes < 1) { <text>Vừa xong</text> }
                                else if (timeSpan.TotalMinutes < 60) { <text>@((int)timeSpan.TotalMinutes) phút trước</text> }
                                else if (timeSpan.TotalHours < 24) { <text>@((int)timeSpan.TotalHours) giờ trước</text> }
                                else { <text>@notification.CreatedAt.ToString("dd/MM/yyyy HH:mm")</text> }
                            }
                        </span>
                    </div>
                    
                    @if (!notification.IsRead)
                    {
                        <i class="fas fa-circle text-primary" style="font-size: 10px; margin-left: 10px; color: var(--lofi-sage) !important;"></i>
                    }
                </a>
            }
        </div>
    }
    else
    {
        <div class="empty-notification-state">
            <i class="fas fa-bell-slash fa-4x mb-3 text-muted"></i>
            <p>Bạn chưa có thông báo nào.</p>
        </div>
    }
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/notification.css" asp-append-version="true" />
}
