@model MTU.Models.DTOs.PostDto

<article class="post-card feed-card" data-post-id="@Model.PostId">
    <header class="post-header">
        <div class="post-author">
            <div class="post-avatar" aria-hidden="true">
                <img src="@Model.AuthorAvatar" alt="@Model.AuthorName">
            </div>
            
            <div class="post-authorBody">
                <div class="post-authorName">@Model.AuthorName</div>
                <div class="post-meta">@Model.TimeAgo</div>
            </div>
        </div>
        
        <button class="post-more" type="button" aria-label="Tùy chọn" onclick="togglePostMenu(this)">
            <i class="fa-solid fa-ellipsis"></i>
        </button>
        <div class="post-menu-dropdown">
            @if (Model.IsOwnPost)
            {
                <button class="post-menu-item post-menu-delete" onclick="deletePost(@Model.PostId)">
                    <i class="fa-solid fa-trash"></i>
                    Xóa bài viết
                </button>
                <button class="post-menu-item" onclick="editPost(@Model.PostId)">
                    <i class="fa-solid fa-pen"></i>
                    Chỉnh sửa
                </button>
                <div class="post-menu-separator" style="height: 1px; background: #eee; margin: 4px 0;"></div>
                <div class="post-menu-header" style="padding: 4px 16px; font-size: 11px; color: #888; font-weight: 600;">THAY ĐỔI QUYỀN RIÊNG TƯ</div>
                <button class="post-menu-item" onclick="updatePrivacy(@Model.PostId, 'public')">
                    <i class="fa-solid fa-globe"></i>
                    Công khai
                </button>
                <button class="post-menu-item" onclick="updatePrivacy(@Model.PostId, 'friends')">
                    <i class="fa-solid fa-user-group"></i>
                    Bạn bè
                </button>
                <button class="post-menu-item" onclick="updatePrivacy(@Model.PostId, 'private')">
                    <i class="fa-solid fa-lock"></i>
                    Chỉ mình tôi
                </button>
            }
            else
            {
                <button class="post-menu-item" onclick="toggleSavePost(@Model.PostId, this)">
                    <i class="@(Model.IsSavedByCurrentUser ? "fa-solid fa-bookmark" : "fa-regular fa-bookmark")"></i>
                    <span>@(Model.IsSavedByCurrentUser ? "Bỏ lưu bài viết" : "Lưu bài viết")</span>
                </button>
                <button class="post-menu-item">
                    <i class="fa-solid fa-eye-slash"></i>
                    Ẩn bài viết
                </button>
                <button class="post-menu-item post-menu-report">
                    <i class="fa-solid fa-flag"></i>
                    Báo cáo
                </button>
            }
        </div>
    </header>

    <div class="post-body">
        @if (!string.IsNullOrWhiteSpace(Model.Content))
        {
            <div class="post-content">@Model.Content</div>
        }

        @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
        {
            <div class="post-media">
                <img class="post-mediaImage" src="@Model.ImageUrl" alt="Post image" />
            </div>
        }

        @if (!string.IsNullOrWhiteSpace(Model.VideoUrl))
        {
            <div class="post-media">
                <video controls class="post-mediaVideo" style="width: 100%; max-height: 500px; background: #000; border-radius: 8px;">
                    <source src="@Model.VideoUrl" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        }

        @if (!string.IsNullOrWhiteSpace(Model.FileUrl))
        {
            <div class="post-attachment" style="margin-top: 12px; padding: 12px; background: #f0f2f5; border-radius: 8px; border: 1px solid #ddd;">
                <a href="@Model.FileUrl" target="_blank" class="post-fileLink" style="display: flex; align-items: center; text-decoration: none; color: #333;">
                    <div class="post-fileIcon" style="margin-right: 12px; font-size: 24px; color: #E74C3C;">
                        <i class="fa-solid fa-file-pdf"></i>
                    </div>
                    <div class="post-fileInfo" style="flex: 1;">
                        <div class="post-fileName" style="font-weight: 500; word-break: break-all;">
                            @Model.FileName
                        </div>
                        <div class="post-fileAction" style="font-size: 13px; color: #65676b;">
                            Click to download/view
                        </div>
                    </div>
                    <div class="post-fileDownload">
                        <i class="fa-solid fa-download" style="color: #65676b;"></i>
                    </div>
                </a>
            </div>
        }
    </div>

    <div class="post-stats">
        <div class="post-likes">
            <i class="post-likeIcon fa-solid fa-thumbs-up"></i>
            <span class="post-likeCount">@Model.LikeCount</span>
        </div>
        <div class="post-counts">
            <span class="post-countItem"><span class="post-commentCount">@Model.CommentCount</span> bình luận</span>
            <span class="post-countItem">0 chia sẻ</span>
        </div>
    </div>

    <div class="post-actions">
        <button class="post-actionBtn post-action-like" type="button" data-liked="@Model.IsLikedByCurrentUser.ToString().ToLower()">
            <i class="post-actionIcon @(Model.IsLikedByCurrentUser ? "fa-solid" : "fa-regular") fa-thumbs-up"></i>
            <span class="post-actionText">Thích</span>
        </button>

        <button class="post-actionBtn post-action-comment" type="button">
            <i class="post-actionIcon fa-regular fa-comment"></i>
            <span class="post-actionText">Bình luận</span>
        </button>

        <button class="post-actionBtn post-action-share" type="button">
            <i class="post-actionIcon fa-solid fa-share"></i>
            <span class="post-actionText">Chia sẻ</span>
        </button>
    </div>

    <details class="post-comments-expandable">
        <summary class="post-comments-toggle" style="display: none;">
            Toggle Comments
        </summary>
        
        <div class="post-commentsPanel">
            <div class="post-commentRow">
                <div class="post-commentAvatar" aria-hidden="true">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="post-commentBox">
                    <input class="post-commentInput" type="text" placeholder="Viết bình luận..." />
                    <button class="post-commentSend" type="button" aria-label="Gửi">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <div class="post-commentList">
                @* Comments will be loaded dynamically via Ajax *@
            </div>
        </div>
    </details>
</article>
