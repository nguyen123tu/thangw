@model MTU.Models.DTOs.ProfileDto

@{
    var studentGender = Model.Student?.Gender ?? "";
    var studentFaculty = Model.Student?.Faculty ?? "";
    var studentClass = Model.Student?.Class ?? "";
    var studentDob = Model.Student?.DateOfBirth;
    var firstName = Model.FullName?.Split(' ').FirstOrDefault() ?? "";
    var lastName = Model.FullName?.Contains(' ') == true ? string.Join(" ", Model.FullName.Split(' ').Skip(1)) : "";
}

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-md-down">
        <div class="modal-content edit-profile-modal">
            <!-- Modal Header -->
            <div class="modal-header edit-profile-header">
                <h5 class="modal-title" id="editProfileModalLabel">
                    <i class="fa-solid fa-pen-to-square"></i>
                    Chỉnh sửa hồ sơ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body edit-profile-body">
                <form id="editProfileForm">
                    @Html.AntiForgeryToken()
                    
                    <div class="row g-4">
                        <!-- LEFT COLUMN -->
                        <div class="col-md-6">
                            <!-- Basic Info Section -->
                            <div class="edit-section">
                                <h6 class="edit-section-title">
                                    <i class="fa-solid fa-user"></i>
                                    Thông tin cơ bản
                                </h6>

                                <!-- First Name & Last Name -->
                                <div class="row g-3 mb-3">
                                    <div class="col-6">
                                        <label for="firstNameInput" class="edit-label">Họ</label>
                                        <input type="text" 
                                               class="form-control edit-input" 
                                               id="firstNameInput" 
                                               name="firstName"
                                               placeholder="Nhập họ..."
                                               value="@firstName">
                                    </div>
                                    <div class="col-6">
                                        <label for="lastNameInput" class="edit-label">Tên</label>
                                        <input type="text" 
                                               class="form-control edit-input" 
                                               id="lastNameInput" 
                                               name="lastName"
                                               placeholder="Nhập tên..."
                                               value="@lastName">
                                    </div>
                                </div>

                                <!-- Bio -->
                                <div class="edit-field">
                                    <label for="bioInput" class="edit-label">
                                        Giới thiệu bản thân
                                    </label>
                                    <textarea class="form-control edit-input" 
                                              id="bioInput" 
                                              name="bio" 
                                              rows="3" 
                                              maxlength="500" 
                                              placeholder="Viết vài dòng về bản thân...">@Model.Bio</textarea>
                                    <div class="edit-hint">
                                        <span id="bioCharCount">@(Model.Bio?.Length ?? 0)</span>/500 ký tự
                                    </div>
                                </div>

                                <!-- Gender with Icons -->
                                <div class="edit-field">
                                    <label class="edit-label">Giới tính</label>
                                    <div class="gender-options">
                                        <label class="gender-option @(studentGender == "Nam" ? "selected" : "")">
                                            <input type="radio" name="gender" value="Nam" @(studentGender == "Nam" ? "checked" : "")>
                                            <i class="fa-solid fa-mars"></i>
                                            <span>Nam</span>
                                        </label>
                                        <label class="gender-option @(studentGender == "Nữ" ? "selected" : "")">
                                            <input type="radio" name="gender" value="Nữ" @(studentGender == "Nữ" ? "checked" : "")>
                                            <i class="fa-solid fa-venus"></i>
                                            <span>Nữ</span>
                                        </label>
                                        <label class="gender-option @(studentGender == "Khác" ? "selected" : "")">
                                            <input type="radio" name="gender" value="Khác" @(studentGender == "Khác" ? "checked" : "")>
                                            <i class="fa-solid fa-genderless"></i>
                                            <span>Khác</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Date of Birth -->
                                <div class="edit-field">
                                    <label for="dateOfBirthInput" class="edit-label">Ngày sinh <span class="optional-text">(không bắt buộc)</span></label>
                                    <input type="date" 
                                           class="form-control edit-input" 
                                           id="dateOfBirthInput" 
                                           name="dateOfBirth" 
                                           value="@(studentDob?.ToString("yyyy-MM-dd") ?? "")">
                                </div>

                                <!-- Location -->
                                <div class="edit-field">
                                    <label for="locationInput" class="edit-label">Nơi sinh sống</label>
                                    <input type="text" 
                                           class="form-control edit-input" 
                                           id="locationInput" 
                                           name="location"
                                           list="locationList"
                                           autocomplete="off"
                                           placeholder="Nhập tỉnh thành..."
                                           value="@Model.Location">
                                    <datalist id="locationList">
                                        <option value="Hà Nội"></option>
                                        <option value="TP. Hồ Chí Minh"></option>
                                        <option value="Đà Nẵng"></option>
                                        <option value="Hải Phòng"></option>
                                        <option value="Cần Thơ"></option>
                                        <option value="Lai Châu"></option>
                                        <option value="Điện Biên"></option>
                                        <option value="Sơn La"></option>
                                        <option value="Lang Sơn"></option>
                                        <option value="Quảng Ninh"></option>
                                        <option value="Thanh Hóa"></option>
                                        <option value="Nghệ An"></option>
                                        <option value="Hà Tĩnh"></option>
                                        <option value="Cao Bằng"></option>
                                        <option value="Tuyên Quang"></option>
                                        <option value="Lào Cai"></option>
                                        <option value="Thái Nguyên"></option>
                                        <option value="Phú Thọ"></option>
                                        <option value="Bắc Ninh"></option>
                                        <option value="Hưng Yên"></option>
                                        <option value="Ninh Bình"></option>
                                        <option value="Quảng Trị"></option>
                                        <option value="Quảng Ngãi"></option>
                                        <option value="Gia Lai"></option>
                                        <option value="Khánh Hòa"></option>
                                        <option value="Lâm Đồng"></option>
                                        <option value="Đắk Lắk"></option>
                                        <option value="Đồng Nai"></option>
                                        <option value="Tây Ninh"></option>
                                        <option value="Vĩnh Long"></option>
                                        <option value="Đồng Tháp"></option>
                                        <option value="Cà Mau"></option>
                                        <option value="An Giang"></option>
                                    </datalist>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT COLUMN -->
                        <div class="col-md-6">
                            <!-- Academic Info Section -->
                            <div class="edit-section">
                                <h6 class="edit-section-title">
                                    <i class="fa-solid fa-graduation-cap"></i>
                                    Thông tin học vấn
                                </h6>

                                <!-- Faculty -->
                                <div class="edit-field">
                                    <label for="facultySelect" class="edit-label">Ngành học</label>
                                    <select class="form-select edit-input" id="facultySelect" name="faculty">
                                        <option value="">Chọn ngành học</option>
                                        @foreach (var faculty in new[] { "Công nghệ thông tin", "Kỹ thuật phần mềm", "Khoa học máy tính", "Hệ thống thông tin", "An toàn thông tin", "Trí tuệ nhân tạo", "Khoa học dữ liệu", "Mạng máy tính" })
                                        {
                                            if (studentFaculty == faculty)
                                            {
                                                <option value="@faculty" selected>@faculty</option>
                                            }
                                            else
                                            {
                                                <option value="@faculty">@faculty</option>
                                            }
                                        }
                                    </select>
                                </div>

                                <!-- Academic Year -->
                                <div class="edit-field">
                                    <label for="academicYearSelect" class="edit-label">Niên khóa</label>
                                    <select class="form-select edit-input" id="academicYearSelect" name="academicYear">
                                        <option value="">Chọn niên khóa</option>
                                        @foreach (var year in new[] { ("KP21", "KP21 (2021-2025)"), ("KP22", "KP22 (2022-2026)"), ("KP23", "KP23 (2023-2027)"), ("KP24", "KP24 (2024-2028)"), ("KP25", "KP25 (2025-2029)"), ("KP26", "KP26 (2026-2030)"), ("KP27", "KP27 (2027-2031)") })
                                        {
                                            if (studentClass.StartsWith(year.Item1))
                                            {
                                                <option value="@year.Item1" selected>@year.Item2</option>
                                            }
                                            else
                                            {
                                                <option value="@year.Item1">@year.Item2</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>

                            <!-- Interests Section -->
                            <div class="edit-section">
                                <h6 class="edit-section-title">
                                    <i class="fa-solid fa-heart"></i>
                                    Sở thích
                                </h6>
                                
                                <div class="interests-grid" id="interestsGrid">
                                    <!-- Interests will be populated by JavaScript -->
                                </div>
                                <input type="hidden" id="interestsInput" name="interests" value="@(Model.Interests != null ? Model.Interests : "")">
                            </div>
                        </div>
                    </div>

                    <!-- Error Message -->
                    <div id="generalError" class="alert alert-danger d-none mt-3" role="alert"></div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer edit-profile-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                    Hủy
                </button>
                <button type="button" class="btn btn-primary" id="saveProfileBtn">
                    <i class="fa-solid fa-check"></i>
                    Lưu thay đổi
                </button>
            </div>
        </div>
    </div>
</div>

<style>
/* Edit Profile Modal Styles - Using CSS Variables */
.edit-profile-modal {
    border: var(--border-width) solid var(--border-primary);
    border-radius: 16px;
    box-shadow: var(--shadow-hard);
    overflow: hidden;
}

.edit-profile-header {
    background: var(--lofi-sage);
    color: var(--lofi-white);
    border-bottom: var(--border-width) solid var(--border-primary);
    padding: 16px 24px;
}

.edit-profile-header .modal-title {
    font-weight: 700;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--lofi-white);
}

.edit-profile-header .btn-close {
    filter: brightness(0) invert(1);
}

.edit-profile-body {
    padding: 24px;
    background: var(--lofi-cream);
    max-height: 70vh;
    overflow-y: auto;
}

.edit-section {
    background: var(--lofi-white);
    border: var(--border-width) solid var(--border-primary);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-hard-sm);
}

.edit-section-title {
    font-weight: 700;
    font-size: 1rem;
    color: var(--lofi-sage);
    margin-bottom: 16px;
    padding-bottom: 10px;
    border-bottom: var(--border-width) dashed var(--lofi-muted);
    display: flex;
    align-items: center;
    gap: 8px;
}

.edit-section-title i {
    font-size: 1.1rem;
}

.edit-field {
    margin-bottom: 16px;
}

.edit-field:last-child {
    margin-bottom: 0;
}

.edit-label {
    display: block;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-primary);
    margin-bottom: 6px;
}

.optional-text {
    font-weight: 400;
    color: var(--lofi-muted);
    font-size: 0.8rem;
}

.edit-input {
    border: var(--border-width) solid var(--lofi-muted);
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 0.95rem;
    transition: var(--transition-smooth);
    background: var(--lofi-white);
}

.edit-input:focus {
    border-color: var(--lofi-sage);
    box-shadow: 0 0 0 3px rgba(148, 175, 134, 0.2);
    outline: none;
}

.edit-input::placeholder {
    color: var(--lofi-muted);
}

.edit-hint {
    font-size: 0.8rem;
    color: var(--lofi-muted);
    margin-top: 4px;
}

/* Gender Options with Icons */
.gender-options {
    display: flex;
    gap: 12px;
}

.gender-option {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 12px;
    background: var(--lofi-cream);
    border: var(--border-width) solid var(--lofi-muted);
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition-smooth);
}

.gender-option input {
    display: none;
}

.gender-option i {
    font-size: 1.5rem;
    color: var(--lofi-muted);
}

.gender-option span {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
}

.gender-option:hover {
    border-color: var(--lofi-sage);
    background: var(--lofi-white);
}

.gender-option.selected,
.gender-option:has(input:checked) {
    border-color: var(--lofi-sage);
    background: var(--lofi-sage);
}

.gender-option.selected i,
.gender-option:has(input:checked) i {
    color: var(--lofi-white);
}

.gender-option.selected span,
.gender-option:has(input:checked) span {
    color: var(--lofi-white);
}

/* Interests Grid */
.interests-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
    padding: 4px;
}

.interest-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    background: var(--lofi-cream);
    border: var(--border-width) solid var(--lofi-muted);
    border-radius: 20px;
    cursor: pointer;
    transition: var(--transition-smooth);
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-primary);
}

.interest-chip:hover {
    background: var(--lofi-white);
    border-color: var(--lofi-sage);
    transform: translateY(-1px);
}

.interest-chip.selected {
    background: var(--lofi-sage);
    color: var(--lofi-white);
    border-color: var(--lofi-sage);
}

.interest-chip i {
    font-size: 0.9rem;
    width: 18px;
    text-align: center;
}

/* Footer */
.edit-profile-footer {
    background: var(--lofi-white);
    border-top: var(--border-width) solid var(--border-primary);
    padding: 16px 24px;
    gap: 12px;
}

.edit-profile-footer .btn {
    padding: 10px 24px;
    font-weight: 600;
    border-radius: 8px;
    border-width: var(--border-width);
}

.edit-profile-footer .btn-primary {
    background: var(--lofi-sage);
    border-color: var(--border-primary);
    box-shadow: var(--shadow-hard-sm);
    color: var(--lofi-white);
}

.edit-profile-footer .btn-primary:hover {
    transform: translate(2px, 2px);
    box-shadow: none;
    background: var(--lofi-sage);
}

.edit-profile-footer .btn-outline-secondary {
    border-color: var(--lofi-muted);
    color: var(--lofi-muted);
}

/* Scrollbar styling */
.edit-profile-body::-webkit-scrollbar,
.interests-grid::-webkit-scrollbar {
    width: 6px;
}

.edit-profile-body::-webkit-scrollbar-track,
.interests-grid::-webkit-scrollbar-track {
    background: var(--lofi-cream);
    border-radius: 3px;
}

.edit-profile-body::-webkit-scrollbar-thumb,
.interests-grid::-webkit-scrollbar-thumb {
    background: var(--lofi-muted);
    border-radius: 3px;
}

@@media (max-width: 768px) {
    .edit-profile-body {
        padding: 16px;
    }
    
    .edit-section {
        padding: 16px;
    }
    
    .interests-grid {
        grid-template-columns: 1fr;
    }
    
    .gender-options {
        flex-direction: column;
    }
}
</style>


